- name: Install ODL # TODO: переписать на нормальный Ansible
  become: yes
  shell: |
    apt update -y
    apt-get install -y openjdk-8-jdk

- name: Install ODL # TODO: переписать на нормальный Ansible
  shell: |
    wget https://nexus.opendaylight.org/content/repositories/public/org/opendaylight/integration/distribution-karaf/0.5.1-Boron-SR1/distribution-karaf-0.5.1-Boron-SR1.tar.gz
    rm -rf distribution-karaf-0.5.1-Boron-SR1/
    tar xvfz distribution-karaf-0.5.1-Boron-SR1.tar.gz

- name: Configure featuresBoot
  lineinfile:
    path: distribution-karaf-0.5.1-Boron-SR1/etc/org.apache.karaf.features.cfg
    line: featuresBoot=config,standard,region,package,kar,ssh,management,odl-sfc-provider,odl-sfc-core,odl-sfc-ui,odl-sfc-openflow-renderer,odl-sfc-scf-openflow,odl-sfc-sb-rest,odl-sfc-ovs,odl-sfc-netconf
    regexp: 'featuresBoot='

- name: Start ODL # TODO: переписать на нормальный Ansible
  shell: |
    set -x
    cd distribution-karaf-0.5.1-Boron-SR1
    ./bin/stop
    rm -rf data/ snapshots/ journal/ instances/ karaf.pid lock
    setsid ./bin/start &
    sleep 200
